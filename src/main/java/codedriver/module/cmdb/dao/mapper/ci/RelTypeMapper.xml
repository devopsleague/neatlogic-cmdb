<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="codedriver.module.cmdb.dao.mapper.ci.RelTypeMapper">
	<select id="checkRelTypeIsInUsed" parameterType="java.lang.Long" resultType="int">
		SELECT COUNT(1) FROM cmdb_rel WHERE type_id = #{value}
	</select>

	<select id="checkRelTypeNameIsExists" parameterType="codedriver.module.cmdb.dto.ci.RelTypeVo" resultType="int">
		SELECT COUNT(1) FROM cmdb_reltype WHERE
		name = #{name} AND id != #{id}
	</select>

	<select id="getRelTypeById" parameterType="java.lang.Long" resultType="codedriver.module.cmdb.dto.ci.RelTypeVo">
		SELECT
		`id`,
		`name`
		FROM
		`cmdb_reltype`
		WHERE id = #{value}
	</select>

	<select id="getAllRelType" resultType="codedriver.module.cmdb.dto.ci.RelTypeVo">
		SELECT
		`id`,
		`name`,
		(SELECT COUNT(1) FROM cmdb_rel rel WHERE rel.type_id = a.id) AS invokeCount
		FROM
		`cmdb_reltype` a
		ORDER BY id DESC
	</select>

	<insert id="insertRelType" parameterType="codedriver.module.cmdb.dto.ci.RelTypeVo">
		INSERT INTO cmdb_reltype
		(id, name)
		VALUES
		(#{id}, #{name})
	</insert>

	<update id="updateRelType" parameterType="codedriver.module.cmdb.dto.ci.RelTypeVo">
		UPDATE cmdb_reltype
		SET name=#{name}
		WHERE id=#{id}
	</update>

	<delete id="deleteRelTypeById" parameterType="java.lang.Long">
		DELETE FROM cmdb_reltype WHERE id = #{value}
	</delete>

</mapper>
